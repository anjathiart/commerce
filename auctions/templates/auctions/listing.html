{% extends "auctions/layout.html" %}

{% block body %}
    <div class="listing">
        <h2>{{ listing.title }}</h2>
        {% if user.is_authenticated and user.id != listing.owner.id %}
            {% if watchlist %}
            <form action="{% url 'watchlist' %}" method="POST">
                {% csrf_token %}
                <input name="listing_id" value="{{ listing.id }}" hidden>
                <input name="toggle" value="remove" hidden>
                <input type="submit" value="Remove from watchlist"> 
            </form>
            {% else %}
            <form action="{% url 'watchlist' %}" method="POST">
                {% csrf_token %}
                <input name="listing_id" value="{{ listing.id }}" hidden>
                <input name="toggle" value="add" hidden>
                <input type="submit" value="Add from watchlist"> 
            </form>
            {% endif %}
        {% endif %}
        <img />

        {% if listing.bids.count == 0  %}
    	   <p>Starting bid: R {{ listing.starting_bid }}</p>
        {% else %}
            <p>Current bid: R {{ listing.max_bid.value }}</p>
        {% endif %}

        {% if user.id != listing.owner.id %}
    	<form action="{% url 'place_bid' listing.id %}" method="post">
            {% csrf_token %}
    		<input name="bid" type="number" min="{{ listing.min_bid }}"  placeholder="Your bid value..." />
    		<input type="submit" value="Make bid!">
    	</form>
        {% elif listing.num_bids > 0 and listing.active %}
        <form action="{% url 'accept_bid' listing.id %}" method="POST">
            {% csrf_token %}
            <input type="text" name="bid_id" value="{{ listing.max_bid.id }}" hidden>
            <input type="submit" value="Accept bid">
        </form>
        {% endif %}
        <p>{{ listing.description }}</p>
    </div>
    {% if user.is_authenticated %}
    <form action="{% url 'comment' listing.id %}" method="POST">
         {% csrf_token %}
          <textarea name="comment" class="comment" placholder="Leave a comment"></textarea>
          <input type="submit" value="save">
    </form>
    {% endif %}
    {% for comment in comments %}
        <p>{{ comment.text }}</p>
    {% endfor %}
    
    TODO
{% endblock %}